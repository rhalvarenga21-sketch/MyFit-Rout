// MyFitRout - Global Checkout & GeoIP v4 (Redundant & Hardened & Full Translation)
// Agent 3.0 - Full Page Translation (Nav + Hero + Features + Pricing + FAQ + Footer)

// ==========================================
// üîó LAST LINK CONFIGURATION
// ==========================================
const LASTLINK_CONFIG = {
    essential_monthly: "https://lastlink.com/p/CD85C185A/checkout-payment/",
    essential_annual: "https://lastlink.com/p/C00235787/checkout-payment/",
    pro_weekly: "https://lastlink.com/p/CD7968A27/checkout-payment/",
    pro_monthly: "https://lastlink.com/p/C3A4ECD3D/checkout-payment/",
    pro_annual: "https://lastlink.com/p/C35F0D49B/checkout-payment/"
};

// ==========================================
// üó£Ô∏è TRANSLATIONS MATRIX
// ==========================================
const TRANSLATIONS = {
    PT: {
        // Nav
        nav_features: "Recursos",
        nav_plans: "Planos",
        nav_faq: "FAQ",
        nav_login: "Entrar",

        // Hero
        hero_badge: "Inscreva-se Agora ‚Äî Vagas Limitadas",
        hero_title: `Seu Coach de Fitness de <br/><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500">Alta Performance</span>`,
        hero_subtitle: "Treinos com IA adaptados ao seu corpo, objetivos e limites. Resultados m√°ximos. Treino inteligente. Sem perda de tempo.",
        cta_primary: "COME√áAR AGORA ‚Üí",
        cta_secondary: "TESTAR DEMO GR√ÅTIS ‚Üí",
        hero_social_active: "200+ membros ativos",
        hero_social_rating: "m√©dia de avalia√ß√£o (247 reviews)",

        // Features
        features_main_title: `Por que <span class="text-indigo-400">MyFitRout</span>?`,
        features_subtitle: "Tecnologia de ponta para resultados reais",
        feat_1_title: "Advanced AI Coach", feat_1_desc: "Treino inteligente. Resultados reais. Impulsionado por IA. Receba orienta√ß√µes precisas e respostas em tempo real ‚Äî como ter um coach profissional sob demanda.",
        feat_2_title: "Treinos Personalizados", feat_2_desc: "Sem planos gen√©ricos. Nunca. Seus treinos s√£o feitos para seus objetivos ‚Äî emagrecimento, hipertrofia, for√ßa ou longevidade ‚Äî e evoluem com voc√™.",
        feat_3_title: "Biblioteca de Exerc√≠cios", feat_3_desc: "150+ exerc√≠cios com v√≠deos HD. Aprenda a t√©cnica correta, treine com confian√ßa e reduza drasticamente o risco de les√µes.",
        feat_4_title: "Monitoramento Completo", feat_4_desc: "Tudo rastreado. Cada evolu√ß√£o medida. Registre treinos, monitore performance e receba insights inteligentes para manter seu progresso constante.",
        feat_5_title: "AI Coach Dispon√≠vel 24/7", feat_5_desc: "Treine no seu hor√°rio. Tire d√∫vidas a qualquer momento e receba orienta√ß√µes que se adaptam √† sua rotina e realidade.",
        feat_6_title: "Multiplataforma & Cloud", feat_6_desc: "Treine em qualquer lugar. Qualquer dispositivo. Seus dados sincronizam automaticamente na nuvem ‚Äî seu progresso est√° sempre com voc√™.",

        // Testimonials
        testim_label: "O que nossos membros dizem",
        testim_title: `Resultados Reais de <span class="text-indigo-400">Pessoas Reais</span>`,
        testim_subtitle: "Treino inteligente. Pessoas reais. Progresso real.",
        t1_quote: "Finalmente parece pessoal. Tentei muitos apps, mas o MyFitRout se adapta ao meu progresso.", t1_tag: "For√ßa & Performance",
        t2_quote: "Perfeito para iniciantes. Tinha zero confian√ßa. Os v√≠deos e a IA tornaram tudo simples.", t2_tag: "Perda de Peso",
        t3_quote: "Parei de perder tempo. Cada sess√£o tem um prop√≥sito claro e cabe na minha rotina.", t3_tag: "Longevidade",
        t4_quote: "Parece um coach no bolso. Posso perguntar qualquer coisa e ter feedback instant√¢neo.", t4_tag: "Estilo de Vida",
        t5_quote: "Equil√≠brio perfeito. A IA √© poderosa, mas o app √© f√°cil de usar. S√≥ abro e treino.", t5_tag: "Fitness Geral",
        t6_quote: "Treino em casa e na academia. Ter treinos para ambos faz uma diferen√ßa enorme.", t6_tag: "Perda de Peso",
        t7_quote: "Me sinto mais forte e confiante. Ver resultados semana ap√≥s semana funciona.", t7_tag: "Ganho Muscular",
        t8_quote: "Seguro e bem explicado. Tinha dor no ombro, mas a orienta√ß√£o ajudou muito.", t8_tag: "Mobilidade",
        t9_quote: "Se adapta √† minha vida. Dias cheios, viagens ‚Äî o app ajusta os planos.", t9_tag: "Longevidade",
        t10_quote: "Simples, inteligente e eficaz. Sem distra√ß√µes. Apenas treino que funciona.", t10_tag: "Performance",

        // Pricing Titles & Badges
        pricing_title: `Escolha seu <span class="text-indigo-400">Plano</span>`,
        pricing_subtitle: "Invista em voc√™. Cancele quando quiser.",
        badge_popular: "MAIS POPULAR",

        // Pricing Cards
        p_ess_month_title: "Essential Mensal",
        p_ess_month_desc: "Transforme seu corpo com intelig√™ncia",
        p_ess_month_feats: ["100 perguntas mensais com Coach (IA) personalizado", "Biblioteca completa: 150+ exerc√≠cios em v√≠deo", "Dashboard inteligente de progresso e evolu√ß√£o", "App mobile: treine em qualquer lugar, qualquer hora"],
        p_ess_month_btn: "COME√áAR AGORA",

        p_ess_annual_title: "Essential Anual",
        p_ess_annual_desc: "Economize {sym}38 - Consist√™ncia que transforma",
        p_ess_annual_feats: ["Todos os benef√≠cios do Essential Mensal inclu√≠dos", "Desconto de 25%: economize {sym}38 por ano", "Apenas {sym}8.32/m√™s - investimento m√≠nimo, m√°ximo resultado", "Pague {sym}99.90 treine 365 dias sem preocupa√ß√£o *(Pagamento simplificado)*", "Compromisso inteligente: 12 meses para criar h√°bitos"],
        p_ess_annual_btn: "COME√áAR AGORA",

        p_pro_week_title: "Passe PRO Semanal",
        p_pro_week_desc: "Teste o poder do PRO por apenas {sym}7.90",
        p_pro_week_feats: ["7 dias de acesso TOTAL ao PRO - sem limita√ß√µes", "Zero compromisso", "Conversas ILIMITADAS com o Coach (IA) 24/7", "Perfeito para decider se: \"O plano PRO √© para mim?\"", "Risco zero: apenas {sym}7.90."],
        p_pro_week_btn: "COME√áAR AGORA",

        p_pro_month_title: "PRO Mensal",
        p_pro_month_desc: "Resultados reais, r√°pidos e definitivos",
        p_pro_month_feats: ["Conversas ILIMITADAS com o Coach (IA) 24/7", "Planos de treino personalizados para seu objetivo", "Receitas fit exclusivas (inverno + ver√£o)", "An√°lises avan√ßadas: veja sua evolu√ß√£o em tempo real", "Treinos ilimitados + todos os programas prontos", "Acesso antecipado: teste novidades antes de todos"],
        p_pro_month_btn: "COME√áAR AGORA",

        p_pro_annual_title: "PRO Anual",
        p_pro_annual_desc: "Economize {sym}100 - Compromisso com seus resultados",
        p_pro_annual_feats: ["Tudo do PRO + desconto de 33% ({sym}100 economizados)", "Pague {sym}199- treine 365 dias sem preocupa√ß√£o *(Pagamento simplificado)*", "Apenas {sym}16.65/m√™s - menos que 2 caf√©s por semana", "Garantia estendida: 7 dias para testar sem risco", "Foco total: um ano para transformar seu corpo"],
        p_pro_annual_btn: "COME√áAR AGORA",

        // Suffixes
        per_month: "/m√™s", per_year: "/ano", per_week: "/sem", equiv: "Equivale a",

        // FAQ
        faq_main_title: `Perguntas <span class="text-indigo-400">Frequentes</span>`,
        faq_q1: "Como funciona a IA do MyFitRout?", faq_a1: "O MyFitRout √© impulsionado pelo Google Gemini 2.5, um dos modelos de IA mais avan√ßados dispon√≠veis. Ele analisa seu perfil, objetivos e feedback para criar e ajustar continuamente treinos totalmente personalizados.",
        faq_q2: "Posso cancelar a qualquer momento?", faq_a2: "Sim ‚Äî com certeza. N√£o h√° contratos ou fidelidade. Voc√™ pode cancelar sua assinatura a qualquer momento diretamente no app, de forma r√°pida e sem burocracia.",
        faq_q3: "O MyFitRout serve para iniciantes?", faq_a3: "Definitivamente. O MyFitRout se adapta ao seu n√≠vel de condicionamento e experi√™ncia. Oferecemos orienta√ß√£o e treinos para iniciantes, intermedi√°rios e avan√ßados.",
        faq_q_equip: "Preciso de equipamentos para treinar?", faq_a_equip: "N√£o necessariamente. Voc√™ pode escolher entre treinos em casa ou na academia. Nossa biblioteca inclui rotinas com ou sem equipamentos, para voc√™ treinar do seu jeito.",
        faq_q4: "Como funciona o pagamento?", faq_a4: "Os pagamentos s√£o processados de forma segura via Revolut (Global) e Last Link (Brasil). Aceitamos cart√µes de cr√©dito, Apple Pay e Google Pay atrav√©s de plataformas confi√°veis.",
        faq_q_privacy: "Meus dados est√£o seguros?", faq_a_privacy: "Sim. Sua privacidade √© prioridade. O MyFitRout segue as diretrizes da GDPR (UE) e LGPD (Brasil). Seus dados pessoais e de treino s√£o criptografados, nunca vendidos, e usados apenas para melhorar sua experi√™ncia.",
        disclaimer_ai: "Nota: Os treinos s√£o gerados por Intelig√™ncia Artificial avan√ßada. O Coach √© um assistente virtual treinado para alta performance interativa.",

        // Security & Policy
        secure_msg: "üí≥ Pagamento seguro via {provider} ‚Ä¢ üîí Dados criptografados",
        cancel_title: "Pol√≠tica de Cancelamento Justa:",
        cancel_desc: "Reembolso integral (100%) em at√© 7 dias.<br/>Para planos anuais, ap√≥s 7 dias, ser√° cobrada uma taxa de 20% sobre o valor restante a ser restitu√≠do.",

        // Final CTA
        cta_final_title: `Pronto para <span class="text-indigo-400">Transformar</span><br/>seu Corpo?`,
        cta_final_desc: "Junte-se a nossa comunidade de membros ativos que j√° est√£o alcan√ßando seus objetivos com MyFitRout.",
        cta_final_btn: "Come√ßar Agora",

        // Footer
        footer_desc: "Seu coach de alta performance powered by AI.",
        footer_prod: "Produto",
        footer_support: "Suporte",
        footer_social: "Social",
        footer_copy: "¬© 2026 MyFitRout. Todos os direitos reservados. Feito com üíú para atletas.",
        footer_terms: "Termos de Uso",
        footer_contact: "Contato"
    },
    EN: {
        // Nav
        nav_features: "Features",
        nav_plans: "Pricing",
        nav_faq: "FAQ",
        nav_login: "Login",

        // Hero
        hero_badge: "Join Now ‚Äî Limited Spots Available",
        hero_title: `Your High-Performance <br/><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500">Fitness Coach</span>`,
        hero_subtitle: "AI-driven workouts tailored to your body, goals, and limits. Maximum results. Smarter training. No more wasted time.",
        cta_primary: "START NOW ‚Üí",
        cta_secondary: "TRY FREE DEMO ‚Üí",
        hero_social_active: "200+ active members",
        hero_social_rating: "average rating (247 reviews)",

        // Features
        features_main_title: `Why <span class="text-indigo-400">MyFitRout</span>?`,
        features_subtitle: "Cutting-edge technology for real results",
        feat_1_title: "Advanced AI Coach", feat_1_desc: "Smarter training. Real results. Powered by AI. Get precise, personalized guidance and real-time answers‚Äîjust like having a professional coach on demand.",
        feat_2_title: "Personalized Workouts", feat_2_desc: "No generic plans. Ever. Your workouts are tailored to your goals‚Äîfat loss, muscle gain, strength, or longevity‚Äîand adapt as you evolve.",
        feat_3_title: "Exercise Demo Library", feat_3_desc: "150+ exercises with HD videos. Learn correct technique, train with confidence, and significantly reduce the risk of injuries.",
        feat_4_title: "Full Progress Tracking", feat_4_desc: "Everything tracked. Every improvement measured. Log workouts, monitor performance, and receive smart insights that keep you progressing week after week.",
        feat_5_title: "AI Coach Available 24/7", feat_5_desc: "Train on your schedule, not someone else‚Äôs. Ask questions anytime and get guidance that fits your routine, level, and real-life constraints.",
        feat_6_title: "Multiplatform & Cloud Sync", feat_6_desc: "Train anywhere. Any device. Your data syncs automatically to the cloud‚Äîyour progress is always with you.",

        // Testimonials
        testim_label: "What our members are saying",
        testim_title: `Real Results from <span class="text-indigo-400">Real Members</span>`,
        testim_subtitle: "Smarter training. Real people. Real progress.",
        t1_quote: "This finally feels personal. I‚Äôve tried many apps before, but MyFitRout is the first one that actually adapts.", t1_tag: "Strength & Performance",
        t2_quote: "Perfect for beginners. I had zero confidence at the gym. The demo videos and AI guidance made everything simple.", t2_tag: "Fat Loss",
        t3_quote: "I stopped wasting time. No more guessing what to train. Every session has a clear purpose.", t3_tag: "Longevity",
        t4_quote: "It feels like having a coach in my pocket. I can ask questions anytime and get instant feedback.", t4_tag: "Lifestyle Fitness",
        t5_quote: "Great balance between tech and simplicity. The AI is powerful, but the app is easy to use.", t5_tag: "General Fitness",
        t6_quote: "I train at home and at the gym. Having workouts for both makes a huge difference.", t6_tag: "Weight Loss",
        t7_quote: "I feel stronger and more confident. The progression tracking keeps me motivated.", t7_tag: "Muscle Gain",
        t8_quote: "Safe and well explained. I had shoulder issues and was afraid of getting injured again.", t8_tag: "Mobility & Recovery",
        t9_quote: "It adapts as my life changes. Busy weeks, travel, low energy days ‚Äî the app adjusts.", t9_tag: "Longevity & Health",
        t10_quote: "Simple, smart, and effective. No distractions, no nonsense. Just smart training that actually works.", t10_tag: "Performance",

        // Pricing Titles
        pricing_title: `CHOOSE YOUR <span class="text-indigo-400">PLAN</span>`,
        pricing_subtitle: "Invest in yourself. Cancel anytime.",
        badge_popular: "MOST POPULAR",

        // Pricing Cards
        p_ess_month_title: "Essential Monthly", p_ess_month_desc: "Transform your body with intelligence", p_ess_month_feats: ["100 AI Coach questions/mo (Personalized)", "Complete library: 150+ video exercises", "Smart progress & evolution dashboard", "Mobile App: train anywhere, anytime"], p_ess_month_btn: "START NOW",
        p_ess_annual_title: "Essential Annual", p_ess_annual_desc: "Save {sym}38 - Consistency that transforms", p_ess_annual_feats: ["All Essential Monthly benefits included", "25% Discount: save {sym}38 per year", "Just {sym}8.32/mo - minimum investment, maximum result", "Pay {sym}99.90 train 365 days worry-free *(Simplified payment)*", "Smart commitment: 12 months to build habits"], p_ess_annual_btn: "START NOW",
        p_pro_week_title: "PRO Weekly Pass", p_pro_week_desc: "Test PRO power for just {sym}7.90", p_pro_week_feats: ["7 days of FULL PRO access - no limitations", "Zero commitment", "UNLIMITED AI Coach conversations 24/7", "Perfect to decide: \"Is PRO plan for me?\"", "Zero risk: just {sym}7.90."], p_pro_week_btn: "START NOW",
        p_pro_month_title: "PRO Monthly", p_pro_month_desc: "Real, fast, and definitive results", p_pro_month_feats: ["UNLIMITED AI Coach conversations 24/7", "Personalized workout plans for your goal", "Exclusive fit recipes (winter + summer)", "Advanced analytics: see your evolution in real-time", "Unlimited workouts + all ready-made programs", "Early Access: test new features before everyone"], p_pro_month_btn: "START NOW",
        p_pro_annual_title: "PRO Annual", p_pro_annual_desc: "Save {sym}100 - Commitment to your results", p_pro_annual_feats: ["Everything in PRO + 33% discount ({sym}100 saved)", "Pay {sym}199- train 365 days worry-free *(Simplified payment)*", "Just {sym}16.65/mo - less than 2 coffees/week", "Extended guarantee: 7 days to test risk-free", "Total focus: one year to transform your body"], p_pro_annual_btn: "START NOW",

        // Suffixes
        per_month: "/mo", per_year: "/yr", per_week: "/wk", equiv: "Equivalent to",

        // FAQ
        faq_main_title: `COMMON <span class="text-indigo-400">QUESTIONS</span>`,
        faq_q1: "How does MyFitRout AI work?", faq_a1: "MyFitRout is powered by Google Gemini 2.5, one of the most advanced AI models available. It analyzes your profile, goals, and feedback to create and continuously adjust fully personalized workouts.",
        faq_q2: "Can I cancel anytime?", faq_a2: "Yes ‚Äî absolutely. There are no contracts or commitments. You can cancel your subscription at any time directly in the app, quickly and hassle-free.",
        faq_q3: "Is MyFitRout suitable for beginners?", faq_a3: "Definitely. MyFitRout adapts to your fitness level and experience. We provide guidance and workouts for beginners, intermediate, and advanced users.",
        faq_q_equip: "Do I need equipment to train?", faq_a_equip: "Not necessarily. You can choose between home or gym workouts. Our exercise library includes routines with or without equipment, so you train your way.",
        faq_q4: "How does payment work?", faq_a4: "Payments are processed securely via Revolut (global) and Last Link (Brazil). We accept credit cards, Apple Pay, and Google Pay through trusted payment platforms.",
        faq_q_privacy: "Is my data safe and private?", faq_a_privacy: "Yes. Your privacy is a priority. MyFitRout follows GDPR (EU) and LGPD (Brazil) guidelines. Your personal and training data is encrypted, never sold, and used only to improve your personalized experience.",
        disclaimer_ai: "Note: Workouts are generated by advanced Artificial Intelligence. The Coach is a virtual assistant trained for interactive high performance.",

        // Security & Policy
        secure_msg: "üí≥ Secure payment via {provider} ‚Ä¢ üîí Encrypted data",
        cancel_title: "Fair Cancellation Policy:",
        cancel_desc: "Full refund (100%) within 7 days.<br/>For annual plans, after 7 days, a 20% fee applies to the remaining refundable amount.",

        // Final CTA
        cta_final_title: `Ready to <span class="text-indigo-400">Transform</span><br/>your Body?`,
        cta_final_desc: "Join our community of active members who are already achieving their goals with MyFitRout.",
        cta_final_btn: "Start Now",

        // Footer
        footer_desc: "Your high-performance coach powered by AI.",
        footer_prod: "Product",
        footer_support: "Support",
        footer_social: "Social",
        footer_copy: "¬© 2026 MyFitRout. All rights reserved. Made with üíú for athletes.",
        footer_terms: "Terms of Use",
        footer_contact: "Contact"
    },
    ES: {
        // Nav
        nav_features: "Recursos",
        nav_plans: "Precios",
        nav_faq: "FAQ",
        nav_login: "Entrar",

        // Hero
        hero_badge: "√önete Ahora ‚Äî Plazas Limitadas",
        hero_title: `Tu Coach de Fitness de <br/><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500">Alto Rendimiento</span>`,
        hero_subtitle: "Entrenamientos con IA adaptados a tu cuerpo, objetivos y l√≠mites. Resultados m√°ximos. Entrenamiento inteligente. Sin perder tiempo.",
        cta_primary: "EMPEZAR AHORA ‚Üí",
        cta_secondary: "PRUEBA DEMO GRATIS ‚Üí",
        hero_social_active: "200+ miembros activos",
        hero_social_rating: "calificaci√≥n media (247 rese√±as)",

        // Features
        features_main_title: `¬øPor qu√© <span class="text-indigo-400">MyFitRout</span>?`,
        features_subtitle: "Tecnolog√≠a de punta para resultados reales",
        feat_1_title: "Advanced AI Coach", feat_1_desc: "Entrenamiento inteligente. Resultados reales. Potenciado por IA. Recibe orientaci√≥n precisa y respuestas en tiempo real, como tener un coach profesional on demand.",
        feat_2_title: "Entrenamientos Personalizados", feat_2_desc: "Sin planes gen√©ricos. Jam√°s. Tus entrenamientos se adaptan a tus objetivos ‚Äî p√©rdida de peso, hipertrofia, fuerza o longevidad ‚Äî y evolucionan contigo.",
        feat_3_title: "Biblioteca de Ejercicios", feat_3_desc: "150+ ejercicios con videos HD. Aprende la t√©cnica correcta, entrena con confianza y reduce dr√°sticamente el riesgo de lesiones.",
        feat_4_title: "Seguimiento Completo", feat_4_desc: "Todo rastreado. Cada mejora medida. Registra entrenamientos, monitorea tu rendimiento y recibe insights inteligentes para mantener tu progreso.",
        feat_5_title: "AI Coach Disponible 24/7", feat_5_desc: "Entrena en tu horario. Haz preguntas en cualquier momento y recibe orientaci√≥n que se adapta a tu rutina y realidad.",
        feat_6_title: "Multiplataforma & Cloud", feat_6_desc: "Entrena donde sea. Cualquier dispositivo. Tus datos se sincronizan autom√°ticamente en la nube ‚Äî tu progreso siempre contigo.",

        // Testimonials
        testim_label: "Lo que dicen nuestros miembros",
        testim_title: `Resultados Reales de <span class="text-indigo-400">Miembros Reales</span>`,
        testim_subtitle: "Entrenamiento inteligente. Personas reales. Progreso real.",
        t1_quote: "Por fin se siente personal. He probado muchas apps, pero MyFitRout es la primera que realmente se adapta.", t1_tag: "Fuerza y Rendimiento",
        t2_quote: "Perfecto para principiantes. Ten√≠a cero confianza. Los videos y la IA lo hicieron todo simple.", t2_tag: "P√©rdida de Peso",
        t3_quote: "Dej√© de perder el tiempo. Se acabaron las adivinanzas. Cada sesi√≥n tiene un prop√≥sito claro.", t3_tag: "Longevidad",
        t4_quote: "Es como tener un coach en el bolsillo. Puedo preguntar cualquier cosa y obtener feedback al instante.", t4_tag: "Estilo de Vida",
        t5_quote: "Gran equilibrio entre tecnolog√≠a y simplicidad. La IA es potente, pero la app es f√°cil de usar.", t5_tag: "Fitness General",
        t6_quote: "Entreno en casa y en el gimnasio. Tener rutinas para ambos hace una gran diferencia.", t6_tag: "P√©rdida de Peso",
        t7_quote: "Me siento m√°s fuerte y seguro. El seguimiento del progreso me mantiene motivado.", t7_tag: "Ganancia Muscular",
        t8_quote: "Seguro y bien explicado. Ten√≠a dolor de hombro y miedo a lesionarme. La gu√≠a ayud√≥ mucho.", t8_tag: "Movilidad y Recuperaci√≥n",
        t9_quote: "Se adapta a mi vida. Semanas ocupadas, viajes: la aplicaci√≥n ajusta los planes.", t9_tag: "Longevidad y Salud",
        t10_quote: "Simple, inteligente y eficaz. Sin distracciones. Solo entrenamiento inteligente que funciona.", t10_tag: "Rendimiento",

        // Pricing
        pricing_title: `ELIGE TU <span class="text-indigo-400">PLAN</span>`,
        pricing_subtitle: "Invierte en ti. Cancela cuando quieras.",
        badge_popular: "M√ÅS POPULAR",

        p_ess_month_title: "Essential Mensual", p_ess_month_desc: "Transforma tu cuerpo con inteligencia", p_ess_month_feats: ["100 preguntas mensuales al Coach (IA) personalizado", "Biblioteca completa: 150+ ejercicios en video", "Dashboard inteligente de progreso y evoluci√≥n", "App m√≥vil: entrena donde sea, cuando sea"], p_ess_month_btn: "EMPEZAR AHORA",
        p_ess_annual_title: "Essential Anual", p_ess_annual_desc: "Ahorra {sym}38 - Consistencia que transforma", p_ess_annual_feats: ["Todos los beneficios de Essential Mensual", "Descuento de 25%: ahorra {sym}38 al a√±o", "Solo {sym}8.32/mes - inversi√≥n m√≠nima", "Paga {sym}99.90 entrena 365 d√≠as sin preocupaciones", "Compromiso inteligente: 12 meses para crear h√°bitos"], p_ess_annual_btn: "SUSCRIBIR AHORA",
        p_pro_week_title: "Pase PRO Semanal", p_pro_week_desc: "Prueba el poder de PRO por solo {sym}7.90", p_pro_week_feats: ["7 d√≠as de acceso TOTAL a PRO - sin l√≠mites", "Cero compromiso", "Conversaciones ILIMITADAS con Coach (IA) 24/7", "Perfecto para decidir: '¬øEl plan PRO es para m√≠?'", "Riesgo cero: solo {sym}7.90"], p_pro_week_btn: "EMPEZAR AHORA",
        p_pro_month_title: "PRO Mensual", p_pro_month_desc: "Resultados reales, r√°pidos y definitivos", p_pro_month_feats: ["Conversaciones ILIMITADAS con Coach (IA) 24/7", "Planes de entrenamiento personalizados", "Recetas fit exclusivas (invierno + verano)", "An√°lisis avanzados: evoluci√≥n en tiempo real", "Entrenamientos ilimitados + programas listos", "Acceso anticipado: prueba novedades antes"], p_pro_month_btn: "EMPEZAR AHORA",
        p_pro_annual_title: "PRO Anual", p_pro_annual_desc: "Ahorra {sym}100 - Compromiso con resultados", p_pro_annual_feats: ["Todo de PRO + descuento de 33% ({sym}100 off)", "Paga {sym}199.90 - entrena 365 d√≠as sin preocupaciones", "Solo {sym}16.65/mes - menos que 2 caf√©s por semana", "Garant√≠a extendida: 7 d√≠as para probar sin riesgo", "Foco total: un a√±o para transformar tu cuerpo"], p_pro_annual_btn: "SUSCRIBIR AHORA",
        per_month: "/mes", per_year: "/a√±o", per_week: "/sem", equiv: "Equivale a",

        // FAQ
        faq_main_title: `PREGUNTAS <span class="text-indigo-400">FRECUENTES</span>`,
        faq_q1: "¬øC√≥mo funciona la IA de MyFitRout?", faq_a1: "MyFitRout est√° impulsado por Google Gemini 2.5, uno de los modelos de IA m√°s avanzados. Analiza tu perfil, objetivos y feedback para crear y ajustar continuamente entrenamientos totalmente personalizados.",
        faq_q2: "¬øPuedo cancelar en cualquier momento?", faq_a2: "S√≠ ‚Äî absolutamente. No hay contratos ni compromisos. Puedes cancelar tu suscripci√≥n en cualquier momento directamente en la app, de forma r√°pida y sin complicaciones.",
        faq_q3: "¬øMyFitRout es apto para principiantes?", faq_a3: "Definitivamente. MyFitRout se adapta a tu nivel f√≠sico y experiencia. Ofrecemos orientaci√≥n y entrenamientos para principiantes, intermedios y avanzados.",
        faq_q_equip: "¬øNecesito equipo para entrenar?", faq_a_equip: "No necesariamente. Puedes elegir entre entrenamientos en casa o gimnasio. Nuestra biblioteca incluye rutinas con o sin equipo, para que entrenes a tu manera.",
        faq_q4: "¬øC√≥mo funciona el pago?", faq_a4: "Los pagos se procesan de forma segura v√≠a Revolut (Global) y Last Link (Brasil). Aceptamos tarjetas de cr√©dito, Apple Pay y Google Pay a trav√©s de plataformas confiables.",
        faq_q_privacy: "¬øMis datos est√°n seguros?", faq_a_privacy: "S√≠. Tu privacidad es prioridad. MyFitRout sigue las directrices GDPR (UE) y LGPD (Brasil). Tus datos personales y de entrenamiento est√°n encriptados, nunca se venden, y se usan solo para mejorar tu experiencia.",
        disclaimer_ai: "Nota: Os treinos s√£o gerados por Intelig√™ncia Artificial avan√ßada. O Coach √© um assistente virtual treinado para alta performance interativa.",

        // Security & Policy
        secure_msg: "üí≥ Pago seguro v√≠a {provider} ‚Ä¢ üîí Datos encriptados",

        // FAQ Additional (ES missing above?) 
        // Wait, I can't guarantee line number match for ES because of previous edits. 
        // I'll search for faq_q3 in ES block around line 200? Let's assume the surrounding lines are stable enough.
        // Actually, let's search for "faq_q3" generally if I can't be sure of line numbers? No, ViewFile showed lines.
        // Step 1963 showed up to 485. I didn't see ES block 200 in that view.
        // I'll rely on pattern search for this chunk.
        // ES Block:
        // faq_q3: "Funciona para iniciantes?" -> NO, that's PT.
        // I don't have the ES text for faq_q3 easily to hand from recent view.
        // I'll SKIP ES CHUNK here and do it in a separate View->Edit cycle to be safe? 
        // No, I can guess the ES text? "Funciona para principientes?" no, likely untranslated if I copied PT before?
        // Let's look at previous FULL file read (Step 1865).
        // Line 190: faq_q3: "Funciona para iniciantes?", faq_a3: "Perfeitamente!..." (PT COPY!)
        // In Step 1865, ES block had PT text copy-pasted for FAQs!
        // Aha! So ES FAQ is currently in PT in the JS file!
        // I should fix that too!
        // Target: faq_q3: "Funciona para iniciantes?" inside ES block?
        // But PT block has the same text.
        // I'll just do PT and EN first, and updateUI. ES needs a dedicated fix pass for all FAQs if they are wrong.
        // User asked to fix "one question passed by".
        // Let's stick to adding the Equip question first.

        // Changing strategy: Only update PT/EN and updateUI. Not risking ES collision.
        cancel_title: "Pol√≠tica de Cancelaci√≥n Justa:",
        cancel_desc: "Reembolso completo (100%) en hasta 7 d√≠as.<br/>Para planes anuales, despu√©s de 7 d√≠as, se cobrar√° una tasa del 20% sobre el valor restante a restituir.",

        // Final CTA
        cta_final_title: `¬øListo para <span class="text-indigo-400">Transformar</span><br/>tu Cuerpo?`,
        cta_final_desc: "√önete a nuestra comunidad de miembros activos que ya est√°n logrando sus objetivos con MyFitRout.",
        cta_final_btn: "Empezar Ahora",

        // Footer
        footer_desc: "Tu coach de alto rendimiento con IA.",
        footer_prod: "Producto",
        footer_support: "Soporte",
        footer_social: "Social",
        footer_copy: "¬© 2026 MyFitRout. Todos los derechos reservados. Hecho con üíú para atletas.",
        footer_terms: "T√©rminos de Uso",
        footer_contact: "Contacto"
    }
};

// ==========================================
// üåç GLOBAL PRICING MATRIX
// ==========================================
const GLOBAL_PRICING = {
    BRL: {
        symbol: 'R$', lang: 'PT',
        products: {
            essential_monthly: { id: 'price_essential_monthly', amount: '12,90' },
            essential_annual: { id: 'price_essential_annual', amount: '99,90' },
            pro_weekly: { id: 'price_pro_weekly', amount: '7,90' },
            pro_monthly: { id: 'price_pro_monthly', amount: '24,90' },
            pro_annual: { id: 'price_pro_annual', amount: '199,90', equiv: '16,65' }
        }
    },
    USD: {
        symbol: '$', lang: 'EN',
        products: {
            essential_monthly: { id: 'price_essential_monthly_usd', amount: '12.90' },
            essential_annual: { id: 'price_essential_annual_usd', amount: '99.90' },
            pro_weekly: { id: 'price_pro_weekly_usd', amount: '7.90' },
            pro_monthly: { id: 'price_pro_monthly_usd', amount: '24.90' },
            pro_annual: { id: 'price_pro_annual_usd', amount: '199.90', equiv: '16.65' }
        }
    },
    EUR: {
        symbol: '‚Ç¨', lang: 'EN',
        products: {
            essential_monthly: { id: 'price_essential_monthly_eur', amount: '12.90' },
            essential_annual: { id: 'price_essential_annual_eur', amount: '99.90' },
            pro_weekly: { id: 'price_pro_weekly_eur', amount: '7.90' },
            pro_monthly: { id: 'price_pro_monthly_eur', amount: '24.90' },
            pro_annual: { id: 'price_pro_annual_eur', amount: '199.90', equiv: '16.65' }
        }
    }
};

// ==========================================
// üïµÔ∏è GEO-IP LOGIC (REDUNDANT)
// ==========================================
async function fetchGeoIP() {
    try {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), 3000);
        const response = await fetch('https://ipapi.co/json/', { signal: controller.signal });
        clearTimeout(id);
        const data = await response.json();
        if (data.error) throw new Error("ipapi error");
        return { country: data.country_code, currency: data.currency, source: 'ipapi.co' };
    } catch (e) { console.warn('ipapi.co failed:', e); }

    try {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), 3000);
        const response = await fetch('https://ipwho.is/', { signal: controller.signal });
        clearTimeout(id);
        const data = await response.json();
        if (!data.success) throw new Error("ipwho.is failed");
        return { country: data.country_code, currency: data.currency, source: 'ipwho.is' };
    } catch (e) { console.warn('ipwho.is failed:', e); }

    throw new Error("All GeoIP services failed");
}

async function detectAndSetCurrency() {
    const params = new URLSearchParams(window.location.search);
    const debugCurrency = params.get('currency');

    if (debugCurrency && GLOBAL_PRICING[debugCurrency.toUpperCase()]) {
        console.log(`üîß Debug Override: Forcing ${debugCurrency}`);
        const target = debugCurrency.toUpperCase();
        localStorage.setItem('myfitrout_currency_locked', target);
        // Default EN for non-BRL debug
        const lang = (target === 'BRL') ? 'PT' : 'EN';
        updateUI(target, lang);
        showDebugBanner(target, "Manual Override");
        return;
    }

    try {
        const data = await fetchGeoIP();
        const country = data.country;
        const currency = data.currency;

        let targetCurrency = 'USD';
        let targetLang = 'EN';

        // Map Currency
        if (country === 'BR') targetCurrency = 'BRL';
        else if (currency === 'EUR' || country === 'CH') targetCurrency = 'EUR';
        else targetCurrency = 'USD';

        // Map Language
        if (['BR', 'PT', 'AO', 'MZ'].includes(country)) targetLang = 'PT';
        else if (['ES', 'MX', 'AR', 'CO', 'CL', 'PE', 'EC', 'UY'].includes(country)) targetLang = 'ES';
        else targetLang = 'EN';

        console.log(`üåç Detected (${data.source}): ${country}/${currency} -> Target: ${targetCurrency}`);

        localStorage.setItem('myfitrout_currency_locked', targetCurrency);
        updateUI(targetCurrency, targetLang);

        if (params.has('debug')) showDebugBanner(targetCurrency, data.source);

    } catch (error) {
        console.warn('GeoIP Critical Failure:', error);

        const navLang = (navigator.language || 'en').toLowerCase();
        let fallbackCurr = 'USD';
        let fallbackLang = 'EN';

        if (navLang.includes('pt')) {
            fallbackCurr = 'BRL'; fallbackLang = 'PT';
        } else if (navLang.includes('es')) {
            fallbackCurr = 'USD'; fallbackLang = 'ES';
        }

        localStorage.setItem('myfitrout_currency_locked', fallbackCurr);
        updateUI(fallbackCurr, fallbackLang);
        if (params.has('debug')) showDebugBanner(fallbackCurr, "Browser Fallback");
    }
}

function showDebugBanner(curr, source) {
    const div = document.createElement('div');
    div.className = "fixed bottom-0 left-0 bg-red-600 text-white text-xs p-1 z-50 opacity-75";
    div.innerText = `DEBUG: ${curr} via ${source}`;
    document.body.appendChild(div);
}

// ==========================================
// üé® UI UPDATER
// ==========================================
function updateUI(currencyCode, langCode) {
    const config = GLOBAL_PRICING[currencyCode];
    if (!config) return;

    const lang = (langCode && TRANSLATIONS[langCode]) ? langCode : config.lang;
    const t = TRANSLATIONS[lang] || TRANSLATIONS['EN'];

    const sym = config.symbol;
    const p = config.products;

    const setText = (id, text) => {
        const el = document.getElementById(id);
        if (el && text) el.innerText = text.replace(/{sym}/g, sym);
    };
    const setHtml = (id, html) => {
        const el = document.getElementById(id);
        if (el && html) el.innerHTML = html.replace(/{sym}/g, sym);
    };

    const updateList = (id, items) => {
        const ul = document.getElementById(id);
        if (!ul || !items) return;
        const html = items.map(item => `
            <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-indigo-400 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 9.293l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-slate-300 text-sm md:text-base">${item.replace(/{sym}/g, sym)}</span>
            </li>`).join('');
        ul.innerHTML = html;
    };

    // --- APPLY TRANSLATIONS ---

    // 1. Navigation
    setText('nav-features', t.nav_features);
    setText('nav-plans', t.nav_plans);
    setText('nav-faq', t.nav_faq);
    setText('nav-login', t.nav_login);

    // 2. Hero
    setText('hero-badge', t.hero_badge);
    setHtml('hero-title', t.hero_title);
    setText('hero-subtitle', t.hero_subtitle);
    setText('hero-cta-primary', t.cta_primary);
    setText('hero-cta-secondary', t.cta_secondary);
    setText('hero-social-active', t.hero_social_active);
    setText('hero-social-rating', t.hero_social_rating);

    // Testimonials
    setText('testim-label', t.testim_label);
    setHtml('testim-title', t.testim_title);
    setText('testim-subtitle', t.testim_subtitle);
    for (let i = 1; i <= 10; i++) {
        if (t['t' + i + '_quote']) setText('t' + i + '-quote', t['t' + i + '_quote']);
        if (t['t' + i + '_tag']) setText('t' + i + '-tag', t['t' + i + '_tag']);
    }

    // 3. Features
    setHtml('features-main-title', t.features_main_title);
    setText('features-subtitle', t.features_subtitle);
    // Cards
    setText('feat-1-title', t.feat_1_title); setText('feat-1-desc', t.feat_1_desc);
    setText('feat-2-title', t.feat_2_title); setText('feat-2-desc', t.feat_2_desc);
    setText('feat-3-title', t.feat_3_title); setText('feat-3-desc', t.feat_3_desc);
    setText('feat-4-title', t.feat_4_title); setText('feat-4-desc', t.feat_4_desc);
    setText('feat-5-title', t.feat_5_title); setText('feat-5-desc', t.feat_5_desc);
    setText('feat-6-title', t.feat_6_title); setText('feat-6-desc', t.feat_6_desc);

    // 4. Pricing Headers
    setHtml('txt-choose-plan', t.pricing_title);
    setText('txt-subtitle', t.pricing_subtitle);
    setText('badge-popular', t.badge_popular);

    // 5. Pricing Cards
    setText('txt-essential-title', t.p_ess_month_title);
    setText('txt-essential-desc', t.p_ess_month_desc);
    updateList('features-essential', t.p_ess_month_feats);
    setText('btn-essential', t.p_ess_month_btn);

    setText('txt-essential-title-annual', t.p_ess_annual_title);
    setText('txt-essential-desc-annual', t.p_ess_annual_desc);
    updateList('features-essential-annual', t.p_ess_annual_feats);
    setText('btn-essential-annual', t.p_ess_annual_btn);

    setText('txt-pro-weekly-title', t.p_pro_week_title);
    setText('txt-pro-weekly-desc', t.p_pro_week_desc);
    updateList('features-pro-weekly', t.p_pro_week_feats);
    setText('btn-pro-weekly', t.p_pro_week_btn);

    setText('txt-pro-title', t.p_pro_month_title);
    setText('txt-pro-desc', t.p_pro_month_desc);
    updateList('features-pro', t.p_pro_month_feats);
    setText('btn-pro-monthly', t.p_pro_month_btn);

    setText('txt-annual-title', t.p_pro_annual_title);
    setText('txt-annual-desc', t.p_pro_annual_desc);
    updateList('features-annual', t.p_pro_annual_feats);
    setText('btn-annual', t.p_pro_annual_btn);

    // 6. Prices Numbers
    setHtml('price-essential-monthly', `${sym} ${p.essential_monthly.amount}<span class="text-lg text-slate-400 font-normal">${t.per_month}</span>`);
    setHtml('price-essential-annual', `${sym} ${p.essential_annual.amount}<span class="text-lg text-slate-400 font-normal">${t.per_year}</span>`);
    setHtml('price-pro-weekly', `${sym} ${p.pro_weekly.amount}<span class="text-lg text-slate-400 font-normal">${t.per_week}</span>`);
    setHtml('price-pro-monthly', `${sym} ${p.pro_monthly.amount}<span class="text-lg text-slate-300 font-normal">${t.per_month}</span>`);
    setHtml('price-pro-annual', `${sym} ${p.pro_annual.amount}<span class="text-lg text-slate-400 font-normal">${t.per_year}</span>`);

    // Fix undefined equiv
    const equivLabel = t.equiv || 'Equivalent to';
    setText('price-equiv-pro-annual', `${equivLabel} ${sym} ${p.pro_annual.equiv}${t.per_month}`);

    // 7. FAQ
    setHtml('faq-main-title', t.faq_main_title); // Using HTML for color span
    setText('faq-q1', t.faq_q1); setText('faq-a1', t.faq_a1);
    setText('faq-q2', t.faq_q2); setText('faq-a2', t.faq_a2);
    setText('faq-q3', t.faq_q3); setText('faq-a3', t.faq_a3);
    setText('faq-q-equip', t.faq_q_equip); setText('faq-a-equip', t.faq_a_equip);
    setText('faq-q4', t.faq_q4); setText('faq-a4', t.faq_a4);
    setText('faq-q-privacy', t.faq_q_privacy); setText('faq-a-privacy', t.faq_a_privacy);
    setText('disclaimer-ai', t.disclaimer_ai);

    // Security & Policy
    const providerName = (currencyCode === 'BRL') ? 'Lastlink' : 'Revolut';
    setText('secure-msg', t.secure_msg.replace('{provider}', providerName));

    setText('cancel-title', t.cancel_title);
    setHtml('cancel-desc', t.cancel_desc);

    // Final CTA
    setHtml('cta-final-title', t.cta_final_title);
    setText('cta-final-desc', t.cta_final_desc);
    setText('btn-final-text', t.cta_final_btn);

    // 8. Footer
    setText('footer-desc', t.footer_desc);
    setText('footer-prod-title', t.footer_prod);
    setText('footer-support-title', t.footer_support);
    setText('footer-social-title', t.footer_social);
    setText('footer-copy', t.footer_copy);
    // Links
    setText('footer-features', t.nav_features); // Reuse
    setText('footer-plans', t.nav_plans); // Reuse
    setText('footer-contact', t.footer_contact);
    setText('footer-terms', t.footer_terms);
}

// ==========================================
// üí≥ CHECKOUT LOGIC
// ==========================================
async function checkout(planType) {
    if (window.va) window.va('event', { name: 'Landing Checkout Click', data: { plan: planType } });

    try {
        const currency = localStorage.getItem('myfitrout_currency_locked') || 'USD';

        // üáßüá∑ LASTLINK (BR)
        if (currency === 'BRL') {
            const checkoutUrl = LASTLINK_CONFIG[planType];
            if (!checkoutUrl) { alert("Check configuration"); return; }
            let finalUrl = checkoutUrl;
            if (window.location.search) {
                finalUrl += (finalUrl.includes('?') ? '&' : '?') + window.location.search.substring(1);
            }
            window.location.href = finalUrl;
        }
        // üåç REVOLUT (GLOBAL)
        else {
            const REVOLUT_MAP = {
                essential_monthly: { EUR: "https://checkout.revolut.com/pay/e4aad20a-068b-49e9-adb6-bb48e09da1de", USD: "https://checkout.revolut.com/pay/c08ffc90-35fe-4701-8029-7a947c0ae1bb" },
                essential_annual: { EUR: "https://checkout.revolut.com/pay/f5514a23-333a-403d-8899-a0458433d466", USD: "https://checkout.revolut.com/pay/4c7f4d85-413f-455a-a753-7c7be9535103" },
                pro_weekly: { EUR: "https://checkout.revolut.com/pay/be2ef2b1-2774-47ed-ac96-316e8f524238", USD: "https://checkout.revolut.com/pay/371c21b0-020e-4bbf-bc5a-4b2e1cd179fc" },
                pro_monthly: { EUR: "https://checkout.revolut.com/pay/44bfee78-ac75-4c1b-a3e0-2639be29ef4f", USD: "https://checkout.revolut.com/pay/120ecee5-fb51-4ccf-b8f4-de6ca59df310" },
                pro_annual: { EUR: "https://checkout.revolut.com/pay/3c4dd027-3d72-4c3c-bc75-e264d8f9360f", USD: "https://checkout.revolut.com/pay/71190496-e02a-4ebf-bacc-f22bde2e0da1" }
            };

            const targetCurr = (currency === 'EUR') ? 'EUR' : 'USD';
            const planUrls = REVOLUT_MAP[planType];
            let targetUrlReal = planUrls ? planUrls[targetCurr] : REVOLUT_MAP['essential_monthly']['USD'];

            if (window.location.search) {
                targetUrlReal += (targetUrlReal.includes('?') ? '&' : '?') + window.location.search.substring(1);
            }
            window.location.href = targetUrlReal;
        }
    } catch (e) {
        console.error("Checkout Fatal:", e);
        window.location.href = "https://checkout.revolut.com/pay/c08ffc90-35fe-4701-8029-7a947c0ae1bb";
    }
}

// Init
window.addEventListener('DOMContentLoaded', () => {
    detectAndSetCurrency();
});
window.checkout = checkout;
